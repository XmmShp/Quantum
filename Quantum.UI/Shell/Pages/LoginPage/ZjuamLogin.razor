@page "/zjuam/login"
@using Quantum.Infrastructure.Abstractions
@using Quantum.Infrastructure.Extensions
@using zjuam.zju.edu.cn
@inherits Quantum.Infrastructure.Models.LoginPageBase
@inject IMessageService Message
@inject IZjuamService ZjuamService

<PageTitle>登录 - Quantum</PageTitle>

<div class="login-container">
    <div class="login-box">
        <div class="login-header">
            <h1>欢迎使用 Quantum</h1>
        </div>
        <div class="login-form">
            <div class="form-group">
                <AntDesign.Input Placeholder="职工号/学号/手机号码/邮箱/别名" Size="@InputSize.Large" @bind-Value="@_loginId">
                    <Prefix>
                        <Icon Type="user" Theme="IconThemeType.Outline" />
                    </Prefix>
                </AntDesign.Input>
            </div>
            <div class="form-group">
                <AntDesign.Input Type="InputType.Password" Placeholder="密码" Size="@InputSize.Large" @bind-Value="@_password">
                    <Prefix>
                        <Icon Type="lock" Theme="IconThemeType.Outline" />
                    </Prefix>
                </AntDesign.Input>
            </div>
            <AntDesign.Button Type="@ButtonType.Primary" Block Size="@ButtonSize.Large" AutoLoading OnClick="@HandleLoginAsync">
                统一身份认证登录
            </AntDesign.Button>
        </div>
    </div>
</div>

<style>
    .login-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: calc(100vh - 140px);
        background: #f5f5f5;
        padding: 24px;
    }

    .login-box {
        background: white;
        padding: 32px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        width: 100%;
        max-width: 400px;
    }

    .login-header {
        text-align: center;
        margin-bottom: 32px;
    }

    .form-group {
        margin-bottom: 24px;
    }
</style>

@code {
    private string _loginId = string.Empty;
    private string _password = string.Empty;
    protected override IAccountService AccountService => ZjuamService;

    private async Task HandleLoginAsync()
    {
        if (string.IsNullOrWhiteSpace(_loginId) || string.IsNullOrWhiteSpace(_password))
        {
            await Message.Error("请输入用户名和密码");
            return;
        }

        var loginResult = await Message.LoadingWhen(
            async () => await ZjuamService.LoginAsync(_loginId, _password),
            "登录统一身份认证中..");
        if (loginResult.IsSuccess)
        {
            await Message.Success(loginResult.Message);
            NavigateToReturnUrl();
        }
        else
        { await Message.Error(loginResult.Message); }
    }
}
